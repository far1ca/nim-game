<svg
  class="github-icon"
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 640 640"
  (click)="openGithub()"
>
  <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
  <path
    fill="#ffffff"
    d="M544 160C544 124.7 515.3 96 480 96L160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160zM361.8 471.7C361.8 469.9 361.8 465.7 361.9 460.1C362 448.7 362 431.3 362 416.4C362 400.8 356.8 390.9 350.7 385.7C387.7 381.6 426.7 376.5 426.7 312.6C426.7 294.4 420.2 285.3 409.6 273.6C411.3 269.3 417 251.6 407.9 228.6C394 224.3 362.2 246.5 362.2 246.5C335.6 239 305.6 239 279 246.5C279 246.5 247.2 224.3 233.3 228.6C224.2 251.5 229.8 269.2 231.6 273.6C221 285.3 216 294.4 216 312.6C216 376.2 253.3 381.6 290.3 385.7C285.5 390 281.2 397.4 279.7 408C270.2 412.3 245.9 419.7 231.4 394.1C222.3 378.3 205.9 377 205.9 377C189.7 376.8 204.8 387.2 204.8 387.2C215.6 392.2 223.2 411.4 223.2 411.4C232.9 441.1 279.3 431.1 279.3 431.1C279.3 440.1 279.4 452.8 279.4 461.7C279.4 466.5 279.5 470.3 279.5 471.7C279.5 476 276.5 481.2 268 479.7C202 457.6 155.8 394.8 155.8 321.4C155.8 229.6 226 159.9 317.8 159.9C409.6 159.9 484 229.6 484 321.4C484.1 394.8 439.3 457.7 373.3 479.7C364.9 481.2 361.8 476 361.8 471.7zM271.3 416.9C271.1 415.4 272.4 414.1 274.3 413.7C276.2 413.5 278 414.3 278.2 415.6C278.5 416.9 277.2 418.2 275.2 418.6C273.3 419 271.5 418.2 271.3 416.9zM262.2 420.1C260 420.3 258.5 419.2 258.5 417.7C258.5 416.4 260 415.3 262 415.3C263.9 415.1 265.7 416.2 265.7 417.7C265.7 419 264.2 420.1 262.2 420.1zM247.9 417.9C246 417.5 244.7 416 245.1 414.7C245.5 413.4 247.5 412.8 249.2 413.2C251.2 413.8 252.5 415.3 252 416.6C251.6 417.9 249.6 418.5 247.9 417.9zM235.4 410.6C233.9 409.3 233.5 407.4 234.5 406.5C235.4 405.4 237.3 405.6 238.8 407.1C240.1 408.4 240.6 410.4 239.7 411.2C238.8 412.3 236.9 412.1 235.4 410.6zM226.9 400.6C225.8 399.1 225.8 397.4 226.9 396.7C228 395.8 229.7 396.5 230.6 398C231.7 399.5 231.7 401.3 230.6 402.1C229.7 402.7 228 402.1 226.9 400.6zM220.6 391.8C219.5 390.5 219.3 389 220.2 388.3C221.1 387.4 222.6 387.9 223.7 388.9C224.8 390.2 225 391.7 224.1 392.4C223.2 393.3 221.7 392.8 220.6 391.8zM214.6 385.4C213.3 384.8 212.7 383.7 213.1 382.8C213.5 382.2 214.6 381.9 215.9 382.4C217.2 383.1 217.8 384.2 217.4 385C217 385.9 215.7 386.1 214.6 385.4z"
  />
</svg>
<svg class="bg-svg" preserveAspectRatio="xMidYMid slice" viewBox="10 10 80 80">
  <defs>
    <style>
      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .out-top {
        animation: rotate 20s linear infinite;
        transform-origin: 13px 25px;
      }
      .in-top {
        animation: rotate 10s linear infinite;
        transform-origin: 13px 25px;
      }
      .out-bottom {
        animation: rotate 25s linear infinite;
        transform-origin: 84px 93px;
      }
      .in-bottom {
        animation: rotate 15s linear infinite;
        transform-origin: 84px 93px;
      }
    </style>
  </defs>
  <path
    fill="#eba534"
    class="out-top"
    d="M37-5C25.1-14.7,5.7-19.1-9.2-10-28.5,1.8-32.7,31.1-19.8,49c15.5,21.5,52.6,22,67.2,2.3C59.4,35,53.7,8.5,37-5Z"
  />
  <path
    fill="#ba4822"
    class="in-top"
    d="M20.6,4.1C11.6,1.5-1.9,2.5-8,11.2-16.3,23.1-8.2,45.6,7.4,50S42.1,38.9,41,24.5C40.2,14.1,29.4,6.6,20.6,4.1Z"
  />
  <path
    fill="#eba534"
    class="out-bottom"
    d="M105.9,48.6c-12.4-8.2-29.3-4.8-39.4.8-23.4,12.8-37.7,51.9-19.1,74.1s63.9,15.3,76-5.6c7.6-13.3,1.8-31.1-2.3-43.8C117.6,63.3,114.7,54.3,105.9,48.6Z"
  />
  <path
    fill="#ba4822"
    class="in-bottom"
    d="M102,67.1c-9.6-6.1-22-3.1-29.5,2-15.4,10.7-19.6,37.5-7.6,47.8s35.9,3.9,44.5-12.5C115.5,92.6,113.9,74.6,102,67.1Z"
  />
</svg>

<div class="game-container">
  <div class="game-heading">Nim Game</div>
  <div style="margin: 1rem">
    <div class="game-subheading">
      You've been randomly given x piles of coins, each containing a random amount. Take coins by
      clicking on the piles and inputting the amount you want to take. When you do so, the computer
      will make its' move. The player that can't make a move loses. Can you win?
    </div>
  </div>
  <div class="pile-container">
    @for (pile of piles; track pile.key) {
    <div style="display: flex; flex-direction: column; align-items: center" @coinAnim>
      <div class="pile" (click)="makeInputVisible(pile.key)" id="pile-{{ pile.key }}">
        <img src="assets/images/coin-top.png" width="100px" alt="Coin Stack Top" />
        @for (coin of pile.coinsArray; track coin.id) {
        <img src="assets/images/coin-stack.png" width="100px" alt="Coin Stack" @coinAnim />
        }
        <div class="coin-num">{{ pile.coinsArray.length + 1 }}</div>
      </div>
      <div class="remove-box" [ngClass]="{ 'remove-box-show': showInput === pile.key }">
        <div>Remove coins..</div>
        <div style="display: flex; flex-direction: row; gap: 10px">
          <input
            type="number"
            value="1"
            min="1"
            max="{{ pile.coinsArray.length + 1 }}"
            class="remove-input"
            #removeInput
          />
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 640 640"
            width="2rem"
            (click)="removeCoins(pile, +removeInput.value)"
          >
            <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
            <path
              fill="#63E6BE"
              d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM438 209.7C427.3 201.9 412.3 204.3 404.5 215L285.1 379.2L233 327.1C223.6 317.7 208.4 317.7 199.1 327.1C189.8 336.5 189.7 351.7 199.1 361L271.1 433C276.1 438 282.9 440.5 289.9 440C296.9 439.5 303.3 435.9 307.4 430.2L443.3 243.2C451.1 232.5 448.7 217.5 438 209.7z"
            />
          </svg>
        </div>
      </div>
    </div>
    }
  </div>
  @if(!gameEnded) {
  <div class="move-text">{{ userMove ? 'Your Move!' : 'The robot is making a move..' }}</div>
  } @else {
  <button (click)="restart()" class="restart-btn">Try again?</button>
  <div class="move-text">Game Over! {{ userMove ? 'The robot wins!' : 'You win!' }}</div>
  }
  <button class="modal-btn" (click)="open(content)">How does it work?</button>
  <div class="robot-text-container" [ngClass]="{ 'robot-text-show': showRobotMove }">
    <div class="robot-text">The robot took {{ robotMoveCoins }} from pile {{ robotMovePile }}</div>
  </div>
</div>

<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Winning Strategy</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    The short answer is - <span style="font-weight: 800">bitwise XOR!</span>
    <br />
    <p>
      Basically, if you take the
      <a href="https://en.wikipedia.org/wiki/Bitwise_operation#XOR" target="_blank">bitwise XOR</a>
      of all pile sizes at any point in the game, and the result is 0, then you are in a losing
      position if your opponent plays optimally. If the result is non-zero, you are in a winning
      position. To make a move that forces your opponent into a losing position, you need to make a
      move that results in the XOR of all pile sizes being 0.
    </p>
    <br />
    <p>
      A good question is:
      <span style="font-style: italic">"why is XOR 0 the losing position?"</span> Well, the losing
      state is when there are no coins left - and that state has a XOR of zero.
    </p>
    <br />
    <p>
      From any non-zero XOR state, there is always a move that can be made to reach a zero XOR
      state. Conversely, from a zero XOR state, any move will lead to a non-zero XOR state. Thus,
      players can force their opponents into losing positions by making moves that result in a XOR
      of zero.
    </p>
    <br />
    <a href="https://cp-algorithms.com/game_theory/sprague-grundy-nim.html" target="_blank"
      >You can find the proof for the previous statement here.</a
    >
  </div>
</ng-template>
